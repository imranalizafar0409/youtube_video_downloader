<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Download YouTube videos in HD, fast and free. Mobile responsive and SEO-optimized YouTube downloader." />
  <meta name="keywords" content="YouTube Video Downloader, HD Download, Free Video Downloader" />
  <meta name="author" content="YourSiteName" />
  <title>YouTube Downloader</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
</head>
<body class="bg-gray-100 p-4">
  <div class="max-w-2xl mx-auto text-center">
    <h1 class="text-3xl font-bold mb-4">ðŸŽ¬ YouTube Video Downloader</h1>
    <input id="videoUrl" class="w-full p-3 border rounded mb-4" type="text" placeholder="Paste YouTube link here..." />
    <button onclick="fetchVideo()" class="bg-blue-600 hover:bg-blue-700 text-white w-full p-3 rounded">Fetch Video</button>

    <div id="loading" class="text-gray-600 mt-4 hidden">Loading video info...</div>
    <div id="error" class="text-red-500 mt-4 hidden"></div>

    <div id="videoContainer" class="mt-6 hidden">
      <img id="thumbnail" class="rounded w-full mb-4" alt="Video thumbnail" />
      <select id="resolutions" class="w-full p-2 border rounded h-40 overflow-y-scroll mb-4" size="5"></select>
      <button onclick="download()" class="bg-green-600 hover:bg-green-700 text-white w-full p-3 rounded">Download</button>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
  <script>
    let fetchedUrl = '';

    function fetchVideo() {
      const url = document.getElementById('videoUrl').value;
      if (!url) return showError('Please enter a YouTube URL.');

      document.getElementById('loading').style.display = 'block';
      document.getElementById('error').style.display = 'none';

      axios.post('/api/fetch', { url })
        .then(response => {
          fetchedUrl = url;
          const data = response.data;
          document.getElementById('videoContainer').style.display = 'block';
          document.getElementById('thumbnail').src = data.thumbnail;
          
          const resolutions = document.getElementById('resolutions');
          resolutions.innerHTML = '';
          data.resolutions.forEach(r => {
            const option = document.createElement('option');
            option.value = r.itag;
            option.textContent = `${r.label} (${r.size})`;
            resolutions.appendChild(option);
          });
        })
        .catch(() => showError('Failed to fetch video. Please check the URL.'))
        .finally(() => {
          document.getElementById('loading').style.display = 'none';
        });
    }

    function download() {
      const itag = document.getElementById('resolutions').value;
      if (!itag || !fetchedUrl) return;

      const a = document.createElement('a');
      a.href = `/api/download?url=${encodeURIComponent(fetchedUrl)}&quality=${encodeURIComponent(itag)}`;
      a.setAttribute('download', '');
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
    }

    function showError(msg) {
      const error = document.getElementById('error');
      error.textContent = msg;
      error.style.display = 'block';
    }
  </script>
</body>
</html>
